function UUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0;return(a=="x"?b:b&3|8).toString(16)}).toUpperCase()}var httprequest;
if(typeof XMLHttpRequest!=="undefined")httprequest=function(a,b,c,d){var f=new XMLHttpRequest;f.onreadystatechange=function(){if(this.readyState===4)if(this.status>=200&&this.status<300||this.status===1223){var e=this.getResponseHeader("Content-Type");e==="application/json"||e==="text/json"?d(null,JSON.parse(this.responseText)):d(null,this.responseText)}else d(this.status+" "+this.statusText+"\n"+this.responseText)};f.open(a,b,true,this.username,this.password);f.setRequestHeader("Accept","application/json");
c&&f.setRequestHeader("Content-Type","application/json");f.send(c)};else if(typeof require==="function"){var http=require("http"),urllib=require("url"),base64=require("./base64");httprequest=function(a,b,c,d){b=urllib.parse(b);var f=http.createClient(b.port,b.hostname),e=[];e.push(["Accept","application/json"]);e.push(["Host",b.hostname]);this&&"username"in this&&"password"in this&&e.push(["Authorization","Basic "+base64.encode(this.username+":"+this.password)]);if(c!==null){if(typeof c==="object")c=
JSON.stringify(c);e.push(["Content-Type","application/json"]);e.push(["Content-Length",c.length])}b=b.pathname+(b.search||"");a=f.request(a.toUpperCase(),b,e);var h="";a.addListener("response",function(g){g.setEncoding("utf8");g.addListener("data",function(i){h+=i});g.addListener("end",function(){if(g.statusCode>=200&&g.statusCode<300){var i=g.headers["content-type"];i==="application/json"||i==="text/json"?d(null,JSON.parse(h)):d(null,h)}else d(g.statusCode+": "+h)})});c!==null&&a.write(c,"utf8");
a.end()}}else throw Error("No XHR and no require? What the?");function CouchModel(){if(!(this instanceof arguments.callee))throw Error("Constructor called as a function.");}
CouchModel.newModel=function(a){function b(c){if(c)for(var d in c)this[d]=c[d]}if(!a||!a.url)throw Error("newModel(db) requires a valid db.");if(a.url.charAt(a.url.length-1)!=="/")a.url+="/";b.prototype=new CouchModel;b.prototype.db=a;b.get=function(c,d){var f=this;httprequest.call(a,"GET",a.url+c,null,function(e,h){e?d(e):d(null,new f(h))})};b.list=function(c,d,f){var e=this;httprequest.call(a,"GET",a.url+"_design/"+c+"/_view/"+d+"?include_docs=true",null,function(h,g){var i=[];g.rows.forEach&&g.rows.forEach(function(j){i.push(new e(j.doc))});
f(h,i)})};return b};CouchModel.prototype.readyState="READY";CouchModel.prototype.save=function(a){if(!this._id)this._id=UUID();var b=this;httprequest.call(this.db,"PUT",this.db.url+this._id,JSON.stringify(this),function(c,d){c&&a&&a(c);if(d.rev&&a){b._rev=d.rev;a(null)}else a&&a('Response representation does not include "rev". It is a '+typeof d+": "+d)})};CouchModel.prototype.del=function(a){httprequest.call(this.db,"DELETE",this.db.url+this._id+"?rev="+this._rev,null,a)};
if(typeof exports==="object")exports.CouchModel=CouchModel;
